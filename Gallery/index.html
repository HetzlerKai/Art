<html>
	<head>

		<title> Galerie Kai Hetzler </title>

		<meta charset="utf-8"/>

		<link href='https://fonts.googleapis.com/css?family=Audiowide' rel='stylesheet'>

	 	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

		<style>

		    .pictureScroll{
					width: 85%;
    			display: grid;
			    margin-left: auto;
			    margin-right: auto;
			    margin-top: 10rem;
					overflow: hidden;
				}

				.artwork {
				  opacity: 0;
					visibility: hidden;
					box-shadow: 5px 5px 12px 3px;
					margin-left: auto;
					margin-right: auto;

				  -webkit-transition: opacity 500ms ease-in;
				     -moz-transition: opacity 500ms ease-in;
				      -ms-transition: opacity 500ms ease-in;
				       -o-transition: opacity 500ms ease-in;
				          transition: opacity 500ms ease-in;
				}

				.artwork-loaded {
				    opacity: 1;
						visibility: visible;
				}

				.artwork-name{
					margin-top: 2rem;
					font-size: min(4.5vw, 36px);
			    text-align: center;
				}

				.artwork-type{
					font-size: min(4vw, 25px);
			    text-align: center;
				}

				.artwork-price{
					margin-bottom: 10rem;
					font-size: min(4vw, 25px);
					text-align: center;
				}

				.impressumSection{
					font-size: 20px;
					margin-top: 250px;
					margin-bottom: 100px;
					text-align: center;
					width: 600px;
			    margin-left: auto;
			    margin-right: auto;
					visibility: hidden;
				}

				.impressumSectionVisible{
					visibility: visible;
				}

				.contactSection{
					display: none;

					margin-top: 250px;
					width: 600px;
					text-align: center;
			    margin-left: auto;
			    margin-right: auto;
				}

				.logoImage{
					height: 90px;
					width: 90px;
					border-radius: 50%;
				  margin-left: auto;
				}

				.logoTitle{
			    margin-left: 20px;
			    margin-top: auto;
			    margin-bottom: auto;
					font-size: 40px;
					font-size: min(5vw, 40px);
				}

				.popover *{
					font-family: Audiowide;
					line-height: 150%;
    			font-size: min(4vw, 25px);
				}

				@media only screen and (max-device-width: 600px) {
					.popover {
						width: 100%;
						left: 0px;
					}

					.popover *{
						font-size: 35px !important;
					}
				}

				.logoMenu{
			    margin-right: auto;
			    margin-top: auto;
			    margin-bottom: auto;
			    margin-left: 20px;
			    font-size: 24px;
				}

				.logoContent{
					display: flex;
			    margin-left: auto;
			    margin-right: auto;
			    width: 600px;
			    margin-top: 100px;
					height: 90px;

					opacity: 0;
					visibility: hidden;

					-webkit-transition: opacity 500ms ease-in;
					   -moz-transition: opacity 500ms ease-in;
					    -ms-transition: opacity 500ms ease-in;
					     -o-transition: opacity 500ms ease-in;
					        transition: opacity 500ms ease-in;
				}

				.logoContent-loaded{
					opacity: 1;
					visibility: visible;
				}

				.seriesItem{
				}

				.lineHeight150{
					line-height: 150%;
				}

				body{
					background-color: #f5f3f2; /* darkmode; #121212 */
					font-family: Audiowide;
					width: 100%;
					max-width: 100%;
					/* darkmode; color: darkred; */
				}

				.socialMediaItems {
					width: 50px;
			    margin-left: auto;
			    margin-right: auto;
    			padding-top: 15px;
				}

				/* Style all font awesome icons */
				.fa {
					padding: 14px;
			    font-size: 29px;
			    width: 57px;
			    text-align: center;
			    text-decoration: none;
			    border-radius: 50%;
				}

				/* Add a hover effect if you want */
				.fa:hover {
				  opacity: 0.7;
				}

				.fa-instagram {
				  background: #125688;
				  color: white;
				}

				.artwork-name,
				.artwork-type,
				.artwork-price {
					visibility: hidden;
				}

				.artwork-name.loaded,
				.artwork-type.loaded,
				.artwork-price.loaded {
					visibility: initial !important;
				}

		</style>

		<script>

			//TODO: onorientationchange not resizing correctly

			function imgSizeFit(img, maxWidth, maxHeight, naturalWidth, naturalHeight){
				var ratio = Math.min(1, maxWidth / naturalWidth, maxHeight / naturalHeight);
				img.style.width = naturalWidth * ratio + 'px';
				img.style.height = naturalHeight * ratio + 'px';
			}

			function getImageSize(img, callback) {
			    var wait = setInterval(function() {
			        var w = img.naturalWidth,
			            h = img.naturalHeight;
			        if (w && h) {
			            clearInterval(wait);
			            callback.apply(this, [w, h]);
			        }
			    }, 30);
			}

			/**
			 * Randomize array element order in-place.
			 * Using Durstenfeld shuffle algorithm.
			 */
			function shuffleArray(array) {
			    for (var i = array.length - 1; i > 0; i--) {
			        var j = Math.floor(Math.random() * (i + 1));
			        var temp = array[i];
			        array[i] = array[j];
			        array[j] = temp;
			    }

					array.sort(function(a, b){
						if (a.favour && b.favour) {
							return 0;
						} else if (a.favour) {
							return -1;
						} else {
							return 1;
						}
					});
			}

			function buildContentWithData (aPics) {
				var
				oImage,
				oNameLine,
				sName,
				oTypeLine,
				sType,
				oPriceLine,
				sPrice,
				i = 0,
				iMaxWidth = window.innerWidth * 0.8,
				iMaxHeight = window.innerHeight * 0.8,
				oDisplay = $(".display"),
				oSeriesSelect = $(".seriesSelect"),
				oContent = $(".pictureScroll");

				oContent.empty();
				oSeriesSelect.empty();

				for (i; i < aPics.length; i++) {

					if (aPics[i].publish) {

						oImage = new Image();
						oImage.src = "/pics/" + aPics[i].path;
						oImage.id = "idImage" + i;
						oImage.className = "artwork";
						oImage.sId = aPics[i].id;

						oNameLine = document.createElement('div');
						if (aPics[i].name) {
							sName = aPics[i].name;
						} else {
							sName = "Untitled: Nr. " + aPics[i].id;
						}
						oNameLine.textContent = sName;
						oNameLine.className = "artwork-name";
						oNameLine.id = "artwork-name-" + aPics[i].id;

						oTypeLine = document.createElement('div');
						if (aPics[i].type === "AL") {
							sType = "Acryl auf Leinwand - " + aPics[i].size;
						} else if (aPics[i].type === "AOL") {
							sType = "Acryl und Ölfarbe auf Leinwand - " + aPics[i].size;
						} else if (aPics[i].type === "D") {
							sType = "Digital";
						} else if (aPics[i].type === "A3") {
							sType = "Acryl auf Papier - A3";
						} else if (aPics[i].type === "AO3") {
							sType = "Acryl und Ölfarben auf Papier - A3";
						} else if (aPics[i].type === "A") {
							sType = "Acryl - " + aPics[i].size;
						}
						oTypeLine.textContent = sType;
						oTypeLine.className = "artwork-type";
						oTypeLine.id = "artwork-type-" + aPics[i].id;

						oPriceLine = document.createElement('div');
						if (aPics[i].sold) {
							sPrice = "Verkauft";
						} else if (aPics[i].price) {
							sPrice = aPics[i].price + "€ zzgl. Versandkosten";
						} else if (aPics[i].type === "D") {
							sPrice = "-";
						} else {
							sPrice = "Preis auf Anfrage"
						}
						oPriceLine.textContent = sPrice;
						oPriceLine.className = "artwork-price";
						oPriceLine.id = "artwork-price-" + aPics[i].id;

						oContent.append(oImage);
						oContent.append(oNameLine);
						oContent.append(oTypeLine);
						oContent.append(oPriceLine);
					}
				}


				$(".artwork").each(function () {
					let oImg = $(this);

					getImageSize(oImg[0], function(width, height) {
						imgSizeFit(oImg[0], iMaxWidth, iMaxHeight, width, height);

						setTimeout(function () {
							if (oImg[0].complete) {
									oImg[0].classList.add("artwork-loaded");
									$("#artwork-price-" + oImg[0].sId)[0].classList.add("loaded");
									$("#artwork-type-" + oImg[0].sId)[0].classList.add("loaded");
									$("#artwork-name-" + oImg[0].sId)[0].classList.add("loaded");
							} else {
								oImg.on("load", function () {
									oImg[0].classList.add("artwork-loaded");
									$("#artwork-price-" + oImg[0].sId)[0].classList.add("loaded");
									$("#artwork-type-" + oImg[0].sId)[0].classList.add("loaded");
									$("#artwork-name-" + oImg[0].sId)[0].classList.add("loaded");
								});
							}
						}, 500);
					});
				});

			}

			function buildLogoSection (aSeries) {
				var oLogoImage = new Image(100, 100);
				oLogoImage.src = "/logo/logo.jpg";
				oLogoImage.id = "idLogoImage"
				oLogoImage.className = "logoImage";
				$(".logoContent").prepend(oLogoImage);

				$("#idLogoImage").on("load", function () {
					//this.classList.add("logoImage-loaded");
					$(".logoContent")[0].classList.add("logoContent-loaded");
				});

				var aLines = [];
				for (var i = 0; i < aSeries.length; i++) {
					if (aSeries[i].publish) {
						aLines.push("<a class='seriesItem' onclick='onSeriesChange(\"" + aSeries[i].id + "\")' >" + aSeries[i].name + " </a>"); //onclick='onSeriesChange(\"" + aSeries[i].id + "\")'>
					}
				}
				var sPopoverContent = aLines.join("<br>");
				var sLogoMenu = "<a title='Series' tabIndex='1' data-trigger='focus' data-placement='bottom' data-html='true' class='logoMenu' data-toggle='popover'> &#9660; </a>"; //data-trigger='focus'
				$(".logoContent").append(sLogoMenu);

				setTimeout(function() {
					$('[data-toggle="popover"]').popover({
				    html: true,
				    content: $(sPopoverContent),
						container: 'body'
				  }).on("show.bs.popover", function(){ $(this).data("bs.popover").tip().css("max-width", "100%"); });
				}, 0);
			}

			function onSeriesChange (sSeriesId) {
				var aPicsFiltered;

				aPicsFiltered = _aPics.filter(function(oItem) {
					if (sSeriesId === "0" || sSeriesId === "99") { return true; }
					return oItem.series && oItem.series.indexOf(sSeriesId) >= 0;
				});

				_aPicsFiltered = aPicsFiltered;

				buildContentWithData(aPicsFiltered);
			}

			function instagramIconPressed () {
				window.open("https://www.instagram.com/kaihetzler", "_blank");
			}

			function buildSocialMediaIcons () {
				var oInstagramIcon;

				oInstagramIcon = '<a onclick="instagramIconPressed()" class="fa fa-instagram"></a>';
				$(".socialMediaItems").append(oInstagramIcon);
			}

			jQuery(document).ready(function(){

				window._aPicsFiltered = null;
				window._aPics = null;
				window._aSeries = null;

				window.onorientationchange = function() {
					if (_aPicsFiltered) {
						buildContentWithData(_aPicsFiltered);
					} else if (_aPics) {
						buildContentWithData(_aPics);
					} else {
						$.ajax({
							dataType: "json",
							url: "getDataFile",
							success: function (oData) {
								buildContentWithData(oData.pics);
							},
							error: function (sError) {
								console.log(sError);
							}
						});
					}
				};

				//init
				$.ajax({
				  dataType: "json",
				  url: "getDataFile",
				  success: function (oData) {
						_aPics = oData.pics;
						_aSeries = oData.series;
						buildLogoSection(oData.series);
						buildSocialMediaIcons();
						shuffleArray(oData.pics);
						buildContentWithData(oData.pics);
				  },
					error: function (sError) {
						console.log(sError);
					}
				});

				setTimeout(function(){
					$(".impressumSection")[0].classList.add("impressumSectionVisible");
				}, 200);
			});

		</script>

	</head>

	<body>

		<div class="display">
			<div class="logoContent">
				<h1 class="logoTitle"> Galerie Kai Hetzler </h1>
			</div>
			<div class="seriesSelect"> </div>
			<div class="socialMediaItems"> </div>
			<div class="pictureScroll"> </div>
			<div class="contactSection">
				<address>
					<a href="mailto:hetzler_Kai@web.com">Kai Hetzler</a>
				</address>
			</div>
			<div class="impressumSection">
				<h1>Impressum</h1>

				<h2>Angaben gem&auml;&szlig; &sect; 5 TMG</h2>
				<p>Kai Hetzler<br />
				Boschstr. 15<br />
				69214 Eppelheim</p>

				<h2>Kontakt</h2>
				<a href="mailto:contact@kai-hetzler.art">contact@kai-hetzler.art</a>
				<!--
				<br>
				<a href="tel:+4917684929404" class="lineHeight150" > +4917684929404</a>
				-->
			</div>
		</div>

	</body>

</html>
