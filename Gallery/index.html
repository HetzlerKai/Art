<html>
	<head>

		<title> Galerie Kai Hetzler </title>

		<link href='https://fonts.googleapis.com/css?family=Audiowide' rel='stylesheet'>

		<style>

		    .pictureScroll{
					width: 85%;
    			display: grid;
			    margin-left: auto;
			    margin-right: auto;
			    margin-top: 7rem;
				}

				.artwork {
				  opacity: 0;
					box-shadow: 1px 2px 15px 3px;
					margin-left: auto;
					margin-right: auto;

				  -webkit-transition: opacity 500ms ease-in;
				     -moz-transition: opacity 500ms ease-in;
				      -ms-transition: opacity 500ms ease-in;
				       -o-transition: opacity 500ms ease-in;
				          transition: opacity 500ms ease-in;
				}

				.artwork-loaded {
				    opacity: 1;
				}

				.artwork-name{
					margin-top: 2rem;
					font-size: min(2.5vw, 36px);
			    text-align: center;
				}

				.artwork-type{
					font-size: min(2vw, 25px);
			    text-align: center;
				}

				.artwork-price{
					margin-bottom: 10rem;
					font-size: min(2vw, 25px);
					text-align: center;
				}

				.impressumSection{
					font-size: 20px;
					margin-top: 250px;
					margin-bottom: 100px;
					text-align: center;
					width: 600px;
			    margin-left: auto;
			    margin-right: auto;
				}

				.contactSection{
					display: none;

					margin-top: 250px;
					width: 600px;
					text-align: center;
			    margin-left: auto;
			    margin-right: auto;
				}

				.logoImage{
					height: 100px;
					width: 100px;
					border-radius: 50%;
				}

				.logoTitle{
			    margin-left: 20px;
			    margin-top: auto;
			    margin-bottom: auto;
					font-size: 45px;
				}

				.logoContent{
					display: flex;
			    margin-left: auto;
			    margin-right: auto;
			    width: 600px;
			    margin-top: 100px;
				}

				.lineHeight150{
					line-height: 150%;
				}

				body{
					background-color: #cfcfcf;
					font-family: Audiowide;
				}

				.display .artwork-name,
				.display .artwork-type,
				.display .artwork-price,
				.display .impressumSection {
					visibility: hidden;
				}

				.display.loaded .artwork-name,
				.display.loaded .artwork-type,
				.display.loaded .artwork-price,
				.display.loaded .impressumSection {
					visibility: initial !important;
				}

		</style>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

		<script>

			// function imgSizeFit(img, maxWidth, maxHeight){
			// 	var ratio = Math.min(1, maxWidth / img.naturalWidth, maxHeight / img.naturalHeight);
			// 	img.style.width = img.naturalWidth * ratio + 'px';
			// 	img.style.height = img.naturalHeight * ratio + 'px';
			// }

			function imgSizeFit(img, maxWidth, maxHeight, naturalWidth, naturalHeight){
				var ratio = Math.min(1, maxWidth / naturalWidth, maxHeight / naturalHeight);
				img.style.width = naturalWidth * ratio + 'px';
				img.style.height = naturalHeight * ratio + 'px';
			}

			function getImageSize(img, callback) {
			    var wait = setInterval(function() {
			        var w = img.naturalWidth,
			            h = img.naturalHeight;
			        if (w && h) {
			            clearInterval(wait);
			            callback.apply(this, [w, h]);
			        }
			    }, 30);
			}

			function buildContentWithData (aPics) {
				var
				oImage,
				oNameLine,
				sName,
				oTypeLine,
				sType,
				oPriceLine,
				sPrice,
				i = 0,
				iMaxWidth = window.innerWidth * 0.85, //2100, //85% screensize
				iMaxHeight = window.innerHeight * 0.85, //1200,
				oDisplay = $(".display"),
				oSeriesSelect = $(".seriesSelect"),
				oContent = $(".pictureScroll");

				oContent.empty();
				oSeriesSelect.empty();

				for (i; i < aPics.length; i++) {
					oImage = new Image();
					oImage.src = "/pics/" + aPics[i].path;
					oImage.id = "idImage" + i;
					oImage.className = "artwork";

					oNameLine = document.createElement('div');
					if (aPics[i].name) {
						sName = aPics[i].name;
					} else {
						sName = "untitled";
					}
					oNameLine.textContent = sName;
					oNameLine.className = "artwork-name";

					oTypeLine = document.createElement('div');
					if (aPics[i].type === "AL") {
						sType = "Acryl auf Leinwand - " + aPics[i].size;
					} else if (aPics[i].type === "D") {
						sType = "Digital";
					} else if (aPics[i].type === "A3") {
						sType = "Acryl auf Papier - A3";
					}
					oTypeLine.textContent = sType;
					oTypeLine.className = "artwork-type";

					oPriceLine = document.createElement('div');
					if (aPics[i].sold) {
						sPrice = "Verkauft";
					} else if (aPics[i].price) {
						sPrice = aPics[i].price;
					} else {
						sPrice = "Preis auf Anfrage"
					}
					oPriceLine.textContent = sPrice;
					oPriceLine.className = "artwork-price";

					oContent.append(oImage);
					oContent.append(oNameLine);
					oContent.append(oTypeLine);
					oContent.append(oPriceLine);
				}


				$(".artwork").each(function () {
					let oImg = $(this)[0];

					getImageSize(oImg, function(width, height) {
						imgSizeFit(oImg, iMaxWidth, iMaxHeight, width, height);
					});

					$(this).on("load", function () {
						oImg.classList.add("artwork-loaded");
					})
				});

			}

			function buildContent(aImages){
					var
					oImage,
					i = 0,
					iMaxWidth = window.innerWidth * 0.85, //2100, //85% screensize
					iMaxHeight = window.innerHeight * 0.85, //1200,
					oDisplay = $(".display"),
					oSeriesSelect = $(".seriesSelect"),
					oContent = $(".pictureScroll");

					oContent.empty();
					oSeriesSelect.empty();

					//var	aImages = ["/pics/test2.jpg", "/pics/test.jpg", "/pics/test3.jpg"];

					//TODO: Handle Series
					// oSeriesSelect.append("<Button> Series One </Button>");
					// oSeriesSelect.append("<Button> Series RGB </Button>");
					// oSeriesSelect.append("<Button> Others </Button>");

					for (i; i < aImages.length; i++) {
						oImage = new Image();
						oImage.src = "/pics/" + aImages[i];
						oImage.id = "idImage" + i;
						oImage.className = "artwork";
						oContent.append(oImage);
					}


					$(".artwork").each(function () {
						$(this).on("load", function () {
							imgSizeFit($(this)[0], iMaxWidth, iMaxHeight);
						})
					});
			}

			jQuery(document).ready(function(){

				//handle resizing
				// window.onresize = function() {
				// 	$.ajax({
				// 		dataType: "json",
				// 		url: "getDataFile", //"getAllFileNames",
				// 		success: function (oData) {
				// 			buildContentWithData(oData.pics); //buildContent(aData);
				// 		},
				// 		error: function (sError) {
				// 			console.log(sError);
				// 		}
				// 	});
				// };

				window.onorientationchange = function() {
					$.ajax({
						dataType: "json",
						url: "getDataFile", //"getAllFileNames",
						success: function (oData) {
							buildContentWithData(oData.pics); //buildContent(aData);
						},
						error: function (sError) {
							console.log(sError);
						}
					});
				};

				window.onload = function(){
					$(".display").addClass("loaded")
				};

				//init
				$.ajax({
				  dataType: "json",
				  url: "getDataFile", //"getAllFileNames",
				  success: function (oData) {
						buildContentWithData(oData.pics); //buildContent(aData);
				  },
					error: function (sError) {
						console.log(sError);
					}
				});

				var oLogoImage = new Image(100, 100);
				oLogoImage.src = "/logo/logo.jpg";
				oLogoImage.id = "idLogoImage"
				oLogoImage.className = "logoImage";
				$(".logoContent").prepend(oLogoImage);

			});

		</script>

	</head>

	<body>

		<div class="display">
			<div class="logoContent">
				<h1 class="logoTitle"> Galerie Kai Hetzler </h1>
			</div>
			<div class="seriesSelect"> </div>
			<div class="pictureScroll"> </div>
			<div class="contactSection">
				<address>
					<a href="mailto:hetzler_Kai@web.com">Kai Hetzler</a>
				</address>
			</div>
			<div class="impressumSection">
				<h1>Impressum</h1>

				<h2>Angaben gem&auml;&szlig; &sect; 5 TMG</h2>
				<p>Kai Hetzler<br />
				Boschstr. 15<br />
				69214 Eppelheim</p>

				<h2>Kontakt</h2>
				<a href="mailto:hetzler_Kai@web.com">Hetzler_Kai@web.de</a>
				<br>
				<a href="tel:+4917684929404" class="lineHeight150" > +4917684929404</a>
			</div>
		</div>

	</body>

</html>
